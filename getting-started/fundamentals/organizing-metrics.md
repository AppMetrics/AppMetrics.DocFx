# Organizing Metrics

App Metrics provides a two ways to organize your metrics: 

1. By specifing a **Context** label when [defining your metrics](../intro.md#measuring-application-metrics). By default any all custom Metrics will belong the the "Application" Context.
2. Through the use of **Tags** when [defining your metrics](../intro.md#measuring-application-metrics) or by [configuring tags](configuration.md) globally for all Metrics.

## Metric Contexts

Organizing your Metrics into separate meaningful contexts is helpful for visualization and reporting. Only one level of Context categorization is supported.

The default global context can be modified using the **DefaultContextLabel** in the [configuration options](configuration.md) when configuring your application to use App Metrics.

### Defining a Context on a Metric

To add Metrics to a particular context, the context can be specified when [defining your metrics](../intro.md#measuring-application-metrics). For example:

[!code-csharp[Main](../../src/samples/AppMetrics.Metric.Code.Snippets/AppMetricsRegistryMultipleContexts.cs?highlight=6,10,18,27,31)]

### Filtering in process by Context

The [DefaultMetricsFilter](../../api/App.Metrics.DefaultMetricsFilter.html) can be used to filter Metrics by a Context. This would be useful if we only wanted to report on a particular Metrics Context.

> [!NOTE]
> See [Metrics Filtering](../filtering/index.md) for more details on filtering Metrics.

### Viewing from a Web Host

Below is a snippet from a `/metrics` response generated by a web host using the [App.Metrics.Extensions.Middleware](../intro.md#configuring-a-web-host) nuget package (Note: Metric values have been omitted for brevity).

[!code-json[Main](../../src/samples/App.Metrics.Formatters.Json.Samples/MetricsEndpointResponseMultipleContexts.json?highlight=4,10,18,26)] 

> [!NOTE]
> You'll need to install the [App.Metrics.Formatters.Json](nuget-packages.md) nuget package and `AddJsonSerialization()` in your `Startup.cs` for formatting `/metrics` results as json.

## Metric Tagging

Metrics can be tagged when [defining your metrics](../intro.md#measuring-application-metrics), these tags can then be shipped with your metric values to your database of choice which is useful for commonly-queried metadata. 

[!code-csharp[Main](../../src/samples/AppMetrics.Metric.Code.Snippets/AppMetricsRegistryMultipleContexts.cs?highlight=5,13,21)]

Tags can also be defined for all Metrics globally which is useful for tagging by things like machine name, envrionment, ip address, application name etc.

[!code-csharp[Main](../../src/samples/AppMetrics.Startup.CodeSnippets/StartupWithAppMetricsOptions.cs?highlight=8)]

App Metrics provides an extension method on the AppMetricsOptions delegate passing some envrionment information that can be used to set global tags such as the machine name, assembly version etc.

[!code-csharp[Main](../../src/samples/AppMetrics.Startup.CodeSnippets/StartupWithAppMetricsOptionsEnvTags.cs?highlight=7,8,9,10,11,12,13)]

## Metric Grouping

Metrics can be assigned a group label when they are defined which applies to the context they are belong to. This allows the group to be reported as the same metric but tagged by the metric name. 

An example use case for grouping is recording an APIs response time per endpoint where a timer is recorded per endpoint but then reported as the same metric name tagged with by the endpoint. This allows us to more easily have a dynamic list of endpoints and their response times when visualising with Grafana for example.

Metric Group names can be applied on all Metric Option types, although it is up to the reporter to apply the appropriate tagging as implemented in the [InfluxDB Reporter](../reporting/index.md#influxdb-reporter)

### Filtering in process by Tag Keys

The [DefaultMetricsFilter](../../api/App.Metrics.DefaultMetricsFilter.html) can be used to filter Metrics by a Tag Keys. This would be useful if we only wanted to report on a particular Metrics Tags.

> [!NOTE]
> See [Metrics Filtering](../filtering/index.md) for more details on filtering Metrics.

## Next Steps

- [Measuring Application Metrics](../intro.md#measuring-application-metrics)
- [Sample Applications](../../samples/index.md)
