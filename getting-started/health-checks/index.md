# Health Checks

Health Checks give you the ability to monitor the health of your application by writing a small tests which returns either a healthy or un-healthy result. This is useful not only to test the internal health of your application but also it's external dependencies such as an third party api which your application relies on to function correctly.

Health checks are written by either inheriting `HealthCheck` or using the `IHealthCheckFactory` provided via the `IMetricsHostBuilder`. App Metrics automatically registers any class inheriting `HealthCheck` and will execute all checks asynchronously by either an `IMetricReporter` that is configured or when using [App.Metrics.Extensions.Middleware](../fundamentals/middleware-configuration.md) and the `/health` endpoint is requested. External monitoring tools can be configured to request the `/health` endpoint to continously test the health of your api and alert via desired means. Healthy results from this endpoint will return a 200 status code whereas if any health check fails the endpoint will return a 500 status code.

## Configuring Health Checks

Ensure that health checking is enabled in your `Startup.cs` in the case of an AspNet Application or in your `Program.cs` in the case of a Console Application.
	
[!code-csharp[Main](../../src/samples/AppMetrics.Startup.CodeSnippets/Startup.cs?highlight=7)]    

## Implementing a Health Check

Healths checks can be implemented as a stand alone class:
 	
[!code-csharp[Main](../../src/samples/AppMetrics.HealthCheck.Code.Snippets/DatabaseHealthCheck.cs)]   

Or via the fluent building in your startup code:
       
[!code-csharp[Main](../../src/samples/AppMetrics.Startup.CodeSnippets/StartupFluentHealth.cs?highlight=9,10)]

> [!NOTE]
> As well as scanning the executing assembly for health checks, App Metrics will also scan all referenced assemblies which have a dependency on App.Metrics and register any health checks it finds.

### Viewing from a Web Host

Below is a snippet from a `/health` response generated by a web host using the [App.Metrics.Extensions.Middleware](../intro.md#configuring-a-web-host) nuget package.

[!code-json[Main](../../src/samples/App.Metrics.Formatters.Json.Samples/HealthCheckResult.json)]

### Health Check Results

There are three types of health checks: **Healthy**, **Degraded** and **Unhealthy** as show above.

- Healthy: Can be used to indicate that the check has passed, in a Web Host a **200 Http Status** will be returned.
- Degraded: Can be used to indicate that the check has failed but the application is still functioning as expected, this can be useful for example when different thresholds are met on the number of messages in a queue or an SSL certificate used for signing tokens is about to expire. In a Web Host a **200 Http Status** will be returned along with a **Warning** response header.
- Unhealthy: Can used used to indicate that the check has failed, in a Web Host a **500 Http Status** will be returned. Any health check which throws an uncaught exception will be returned as an unhealthy result when reporting. 

Health Check results can be returned as follows:

[!code-csharp[Main](../../src/samples/AppMetrics.HealthCheck.Code.Snippets/ReturningHealthCheckResults.cs)]

> [!NOTE]
> An external monitoring tools could be used to request the `/health` endpoint at a configured interval to continously monitor and alert the health of your API.